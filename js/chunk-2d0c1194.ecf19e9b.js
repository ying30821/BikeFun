(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c1194"],{4530:function(t,a,e){"use strict";e.r(a);var n=e("7a23"),i={class:"container-fluid px-0"},r={class:"row gx-0"},s={class:"d-md-block col-md-6 col-lg-4 bg-white",ref:"searchList"},o={class:"border-bottom p-1"},c=Object(n["j"])("尋找單車"),d={class:"scrollbar px-1 py-0.75"},l={key:1,class:"fs-5 text-center py-1 mb-0"},p=Object(n["h"])("i",{class:"material-icons-outlined fs-2 align-middle"},"search_off",-1),b=Object(n["j"])(" 目前查無資料 請重新搜尋 "),h=[p,b],m={class:"d-md-block col-md-6 col-lg-8",ref:"map"},g=Object(n["h"])("div",{id:"map"},null,-1),f=[g],y={class:"d-flex d-md-none justify-content-end px-1 py-0.5"};function u(t,a,e,p,b,g){var u=Object(n["C"])("Loading"),v=Object(n["C"])("SearchCard"),S=Object(n["C"])("StnCard"),O=Object(n["C"])("Pagination");return Object(n["v"])(),Object(n["g"])(n["a"],null,[Object(n["k"])(u,{active:b.isLoading,class:"z-index-500"},null,8,["active"]),Object(n["h"])("div",i,[Object(n["h"])("div",r,[Object(n["h"])("div",s,[Object(n["h"])("div",o,[Object(n["k"])(v,{onEmitSearch:g.searchStn,city:t.$filters.allCity},{default:Object(n["L"])((function(){return[c]})),_:1},8,["onEmitSearch","city"])]),Object(n["h"])("div",d,[t.pagination.current_page_data.length>0?(Object(n["v"])(!0),Object(n["g"])(n["a"],{key:0},Object(n["A"])(t.pagination.current_page_data,(function(t){return Object(n["v"])(),Object(n["e"])(S,{key:t.StationUID,cardData:t,onEmitSetview:g.setStnView},null,8,["cardData","onEmitSetview"])})),128)):(Object(n["v"])(),Object(n["g"])("p",l,h))]),Object(n["k"])(O,{pages:t.pagination,onEmitUpdate:t.updatePage},null,8,["pages","onEmitUpdate"])],512),Object(n["h"])("div",m,f,512)]),Object(n["h"])("div",y,[Object(n["h"])("button",{onClick:a[0]||(a[0]=function(){return g.toggleMapAndList&&g.toggleMapAndList.apply(g,arguments)}),class:"hvr_showMap btn btn-outline-primary bg-secondary px-0.5 py-0.25"},Object(n["F"])(b.showMap?"顯示地圖":"顯示列表"),1)])])],64)}e("99af"),e("d3b7"),e("159b"),e("d81d"),e("3ca3"),e("ddb0");var v=e("e11e"),S=e.n(v),O=e("d0f4"),w=e("b1cb"),x=e("1799"),j=e("6452"),k={class:"card-body bg-light px-1"},L={class:"card-title h5 mb-0.75"},D={class:"card-text fs-7 text-dark d-flex align-items-center mb-0.75"},A=Object(n["h"])("i",{class:"bi bi-geo-alt-fill text-primary fs-4 me-0.5"},null,-1),C={class:"d-flex gap-0.75"},P={key:0,class:"border border-gray-600 bg-gray-300 rounded-1 text-gray-600 fs-8 fw-normal px-0.5 py-0.25"},_={key:1,class:"border border-primary bg-secondary rounded-1 text-primary fs-8 fw-normal px-0.5 py-0.25"},B={key:2,class:"border border-gray-600 bg-gray-300 rounded-1 text-gray-600 fs-8 fw-normal px-0.5 py-0.25"},N={key:3,class:"border border-danger bg-notify-danger rounded-1 text-danger fs-8 fw-normal px-0.5 py-0.25"},M={key:4,class:"border border-warning bg-notify-warning rounded-1 text-warning fs-8 fw-normal px-0.5 py-0.25"};function $(t,a,e,i,r,s){return Object(n["v"])(),Object(n["g"])("a",{class:"card d-block border-0 rounded-3 w-100 mb-1.5",href:"#",onClick:a[0]||(a[0]=Object(n["N"])((function(t){return s.setStnView(e.cardData.StationPosition)}),["prevent"]))},[Object(n["h"])("div",k,[Object(n["h"])("h2",L,Object(n["F"])(e.cardData.StationName.Zh_tw),1),Object(n["h"])("p",D,[A,Object(n["h"])("span",null,Object(n["F"])(e.cardData.StationAddress.Zh_tw?e.cardData.StationAddress.Zh_tw:"無此地址"),1)]),Object(n["h"])("div",C,[0===e.cardData.ServiceStatus?(Object(n["v"])(),Object(n["g"])("span",P,"停止營運 ")):1===e.cardData.ServiceStatus?(Object(n["v"])(),Object(n["g"])("span",_,"正常營運 ")):2===e.cardData.ServiceStatus?(Object(n["v"])(),Object(n["g"])("span",B,"暫停營運 ")):Object(n["f"])("",!0),0===e.cardData.AvailableRentBikes?(Object(n["v"])(),Object(n["g"])("span",N,"已無單車 ")):Object(n["f"])("",!0),0===e.cardData.AvailableReturnBikes?(Object(n["v"])(),Object(n["g"])("span",M,"車位已滿 ")):Object(n["f"])("",!0)])])])}var R={props:{cardData:{type:Object}},emits:["emitSetview"],data:function(){return{}},methods:{setStnView:function(t){this.$emit("emitSetview",t)}}},U=e("6b0d"),E=e.n(U);const F=E()(R,[["render",$]]);var T=F,Z={props:{indexSearch:{type:String}},mixins:[w["a"]],components:{SearchCard:j["a"],StnCard:T,Pagination:x["a"]},data:function(){return{map:"",markerLayer:"",bikeIcon:"",myPos:{lon:0,lat:0},apiData:[],isLoading:!1,showMap:!0}},methods:{getStnData:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e="".concat("https://ptx.transportdata.tw/MOTC/v2","/Bike/Station/City/").concat(t,"?$filter=contains(StationName%2FZh_tw%2C'").concat(a,"')%20or%20contains(StationAddress%2FZh_tw%2C'").concat(a,"')&$format=JSON");return this.axios.get(e)},getAvlData:function(t){var a="".concat("https://ptx.transportdata.tw/MOTC/v2","/Bike/Availability/City/").concat(t,"?%24format=JSON");return this.axios.get(a)},getNearByStnData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n="".concat("https://ptx.transportdata.tw/MOTC/v2","/Bike/Station/City/NearBy?$filter=contains(StationName%2FZh_tw%2C'").concat(e,"')%20or%20contains(StationAddress%2FZh_tw%2C'").concat(e,"')&$spatialFilter=nearby(").concat(a,",").concat(t,",1000)&$format=JSON");return this.axios.get(n)},getNearByAvlData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e="".concat("https://ptx.transportdata.tw/MOTC/v2","/Bike/Availability/City/NearBy?$spatialFilter=nearby(").concat(a,",").concat(t,",1000)");return this.axios.get(e)},recombineStnData:function(t,a){var e=this;this.apiData=[],t.forEach((function(t){a.forEach((function(a){if(t.StationUID===a.StationUID){var n={StationUID:t.StationUID,StationName:t.StationName,StationAddress:t.StationAddress,StationPosition:t.StationPosition,ServiceStatus:a.ServiceStatus,AvailableRentBikes:a.AvailableRentBikes,AvailableReturnBikes:a.AvailableReturnBikes,UpdateTime:a.UpdateTime};e.apiData.push(n)}}))}))},renderStn:function(){var t=this;if(this.getPage(),this.markerLayer&&this.markerLayer.clearLayers(),this.apiData.length>0){var a=this.pagination.current_page_data[0].StationPosition.PositionLon,e=this.pagination.current_page_data[0].StationPosition.PositionLat;a&&e&&this.map.setView([e,a],18),this.apiData.forEach((function(a){var e=a.StationPosition.PositionLon,n=a.StationPosition.PositionLat;t.markerLayer.addLayer(S.a.marker([n,e],{icon:O["a"],id:a.StationUID}).bindPopup('\n              <div class="p-0.75">\n                <h5 class="h4">'.concat(a.StationName.Zh_tw,'</h5>\n                <p class="fs-7 text-dark d-flex align-items-center mt-0 mb-0.5">\n                <i class="bi bi-geo-alt-fill text-primary fs-4 me-0.5"></i>').concat(a.StationAddress.Zh_tw,'\n                </p>\n                <p class="fs-7 text-dark d-flex align-items-center mt-0 mb-0.75">\n                <i class="material-icons-outlined text-primary fs-4 me-0.5">history</i>').concat(a.UpdateTime,'\n                </p>\n                <div class="d-flex gap-0.5 mb-0.75">\n                  ').concat(0===a.ServiceStatus?'<p class="border border-gray-600 bg-gray-300 rounded-2 text-gray-600 fs-7 fw-normal px-0.5 py-0.25 my-0">停止營運</p>':"","\n                  ").concat(1===a.ServiceStatus?'<p class="border border-primary bg-secondary rounded-2 text-primary fs-7 fw-normal px-0.5 py-0.25 my-0">正常營運</p>':"","\n                  ").concat(2===a.ServiceStatus?'<p class="border border-gray-600 bg-gray-300 rounded-2 text-gray-600 fs-7 fw-normal px-0.5 py-0.25 my-0">暫停營運</p>':"","\n                  ").concat(a.AvailableRentBikes>1?'<p class="border border-primary bg-secondary rounded-2 text-primary fs-7 fw-normal px-0.5 py-0.25 my-0">尚有單車</p>':"","\n                  ").concat(0===a.AvailableRentBikes?'<p class="border border-danger bg-notify-danger rounded-2 text-danger fs-7 fw-normal px-0.5 py-0.25 my-0">已無單車</p>':"","\n                  ").concat(0===a.AvailableReturnBikes?'<p class="border border-warning bg-notify-warning rounded-2 text-warning fs-7 fw-normal px-0.5 py-0.25 my-0">車位已滿</p>':"",'\n                </div>\n                <div class="d-flex">\n                  <p class="border border-primary rounded-3 fs-6 text-primary text-center w-50 p-0.25 me-1 my-0">可借單車\n                    <span class="d-block fs-3 text-black mt-0.25">').concat(a.AvailableRentBikes,'</span>\n                  </p>\n                  <p class="border border-primary rounded-3 fs-6 text-primary text-center w-50 p-0.25 m-0">可停車位\n                    <span class="d-block fs-3 text-black mt-0.25">').concat(a.AvailableReturnBikes,"</span>\n                  </p>\n                </div>\n              </div>\n            "))),t.map.addLayer(t.markerLayer)}))}},searchStn:function(t){var a=this;this.isLoading=!0;var e=t.city;e||(e="Taipei"),Promise.all([this.getStnData(e,t.keyword),this.getAvlData(e)]).then((function(t){var e=t[0].data,n=t[1].data;a.recombineStnData(e,n),a.renderStn()})).catch((function(t){console.error(t)})).then((function(){a.isLoading=!1}))},setStnView:function(t){this.map.setView([t.PositionLat,t.PositionLon],18),window.screenWidth=document.body.clientWidth,window.screenWidth<768&&this.toggleMapAndList()},toggleMapAndList:function(){this.showMap?(this.$refs.searchList.classList.add("d-none"),this.$refs.map.classList.remove("d-none")):(this.$refs.map.classList.add("d-none"),this.$refs.searchList.classList.remove("d-none")),this.showMap=!this.showMap}},mounted:function(){var t=this;this.map=Object(O["b"])(),this.markerLayer=Object(O["c"])(),this.markerLayer.addTo(this.map),this.map.whenReady((function(){t.$refs.map.classList.add("d-none")}));var a={city:"",keyword:""};this.indexSearch&&(a=JSON.parse(this.indexSearch)),this.searchStn(a)}};const I=E()(Z,[["render",u]]);a["default"]=I}}]);
//# sourceMappingURL=chunk-2d0c1194.ecf19e9b.js.map